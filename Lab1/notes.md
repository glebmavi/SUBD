# Вопросы для подготовки к защите

## Процедура, функция, анонимный блок: отличия, способы вызова, параметризация, вывод информации.

### Процедура
Процедура — это подпрограмма, которая выполняет набор действий и может изменять состояние базы данных. Процедура может принимать параметры (IN, OUT, INOUT), но не обязательно возвращает результат. Процедуры могут изменять данные с помощью команд, таких как `INSERT`, `UPDATE`, `DELETE`, и вызываются через команду `CALL`.

### Функция
Функция — это подпрограмма, которая выполняет вычисления и обязательно возвращает значение. Она также может принимать параметры, но результат всегда возвращается через оператор `RETURN`. Функции обычно используются для вычисления значений или возвращения результата, и они могут вызываться в запросах SQL, например, в командах `SELECT`.

### Анонимный блок
Анонимный блок — это блок кода PL/pgSQL, который выполняется единожды без явного сохранения в базе данных. Анонимный блок не имеет имени и вызывается напрямую, обычно для выполнения серии команд без необходимости сохранять их для повторного использования. Используется, когда необходимо выполнить набор операций один раз. Запускается через `DO $$...$$` в PostgreSQL.

## Системный каталог: описание, назначение, примеры использования.

### Описание
Системный каталог — это набор внутренних таблиц в базе данных, которые хранят информацию о структуре базы данных, включая таблицы, столбцы, индексы, ограничения, роли и другие объекты. Эти каталоги управляются системой и содержат метаданные.

### Назначение
Системные каталоги используются для хранения и управления всей информацией о структуре и организации базы данных. Они помогают системе и пользователям узнать, какие объекты существуют, какие имеют права доступа, какие ограничения применены и т.д. Они также используются для оптимизации запросов и выполнения административных задач.

### Примеры использования
Примеры использования системных каталогов включают получение списка таблиц в схеме (`pg_tables`), получение информации о столбцах таблицы (`pg_attribute`), просмотр ограничений (`pg_constraint`), проверку прав доступа пользователей (`pg_roles`) и многие другие. Например, с помощью запроса к `pg_constraint` можно узнать все ограничения на таблицы в базе данных.

## Роли и права доступа.

### Роли
Роли — это пользователи или группы пользователей, которым назначены права доступа к объектам базы данных. Роль может быть назначена отдельному пользователю или группе пользователей для управления доступом и выполнения операций в системе. Роли могут быть как обычными пользователями, так и суперпользователями с неограниченными правами.

### Права доступа
Права доступа — это разрешения, которые определяют, какие действия может выполнять роль в базе данных. Права могут включать чтение данных (SELECT), изменение данных (INSERT, UPDATE, DELETE), создание объектов (CREATE), управление схемами и таблицами. Права доступа назначаются с помощью команды `GRANT` и могут быть отозваны с помощью команды `REVOKE`. Они обеспечивают контроль за безопасностью и целостностью данных.


# Объяснение системных таблиц и атрибутов

## Таблицы:

1. `pg_constraint`
     - Назначение: Содержит информацию обо всех ограничениях, применённых к таблицам базы данных (включая CHECK, UNIQUE, PRIMARY KEY, FOREIGN KEY и другие).
     - Основные атрибуты:
         - `conname`: Имя ограничения (например, имя CHECK ограничения).
         - `contype`: Тип ограничения (`c` означает CHECK).
         - `conrelid`: Ссылка на таблицу, к которой относится это ограничение.

2. `pg_class`
     - Назначение: Содержит информацию о таблицах и индексах в базе данных. Здесь можно найти информацию о каждой таблице.
     - Основные атрибуты:
         - `relname`: Имя таблицы.
         - `relnamespace`: Ссылка на схему, в которой находится таблица.
         - `oid`: Уникальный идентификатор таблицы (используется для связи с другими таблицами, такими как `pg_constraint` и `pg_attribute`).

3. `pg_namespace`
     - Назначение: Содержит информацию о схемах базы данных.
     - Основные атрибуты:
         - `nspname`: Имя схемы.
         - `oid`: Уникальный идентификатор схемы.

4. `pg_attribute`
     - Назначение: Хранит информацию о столбцах в таблицах базы данных.
     - Основные атрибуты:
         - `attname`: Имя столбца.
         - `attnum`: Порядковый номер столбца в таблице.
         - `attrelid`: Ссылка на таблицу (идентификатор таблицы из `pg_class`).
         - `attnotnull`: Булевый атрибут, который указывает, что столбец имеет ограничение `NOT NULL`.

## Атрибуты:

1. `conname` (в таблице `pg_constraint`)
     - Описание: Имя ограничения.

2. `contype` (в таблице `pg_constraint`)
     - Описание: Тип ограничения. В запросе используются только ограничения типа `CHECK`, которые обозначаются как `c`.

3. `relname` (в таблице `pg_class`)
     - Описание: Имя таблицы, к которой относится ограничение.
     - Пример: Н_ЛЮДИ.

4. `attname` (в таблице `pg_attribute`)
     - Описание: Имя столбца, к которому относится ограничение.
     - Пример: ПОЛ.

5. `pg_get_constraintdef(pg_constraint.oid)`
     - Описание: Функция, возвращающая текстовое описание ограничения.

6. `attnotnull` (в таблице `pg_attribute`)
     - Описание: Булевый атрибут, который указывает, что столбец должен быть `NOT NULL` (значение `TRUE` указывает на наличие этого ограничения).

7. `ROW_NUMBER() OVER ()`
     - Описание: Функция PostgreSQL, которая пронумеровывает строки в результатах запроса, начиная с 1. Используется для вывода порядкового номера ограничения.

## Пример связи таблиц:

 - Для получения CHECK ограничений: таблица `pg_constraint` связывается с `pg_class` через атрибут `conrelid`, чтобы узнать, к какой таблице относится ограничение. Через связь с `pg_attribute` по полю `attrelid` и `attnum` получается информация о столбце, к которому это ограничение применяется.
 - Для получения NOT NULL ограничений: информация берётся напрямую из таблицы `pg_attribute` с проверкой поля `attnotnull`, которая связывается с `pg_class` через `attrelid`.